---
import { getReportByDate, getAllReports } from "../utils/reports";
import { extractBodyContent, extractTitle } from "../utils/htmlParser";
import Layout from "../layouts/Layout.astro";
import Navigation from "../components/Navigation.astro";

export async function getStaticPaths() {
  const reports = getAllReports();
  return reports.map((report) => ({
    params: { date: report.date },
    props: { report },
  }));
}

const { report } = Astro.props;
const { date } = Astro.params;

const bodyContent = report ? extractBodyContent(report.content) : "";
const title = report ? extractTitle(report.content) : "Rapport introuvable";
---

<Layout title={title}>
  {
    report && date ? (
      <>
        <Navigation currentDate={date} />
        <div class="report-content" set:html={bodyContent} />
      </>
    ) : (
      <div class="wrap">
        <div class="error-message">
          <h1>Rapport introuvable</h1>
          <p>Le rapport demandé n'existe pas.</p>
          <a href="/">Retour à l'accueil</a>
        </div>
      </div>
    )
  }
</Layout>

<style>
  .report-content {
    width: 100%;
  }

  .wrap {
    max-width: 1100px;
    margin: 0 auto;
    padding: 20px 16px 60px;
  }

  .error-message {
    text-align: center;
    padding: 60px 20px;
    color: var(--text);
  }

  .error-message h1 {
    font-size: 32px;
    margin-bottom: 16px;
  }

  .error-message a {
    display: inline-block;
    margin-top: 24px;
    padding: 12px 24px;
    background: var(--accent);
    color: white;
    text-decoration: none;
    border-radius: 8px;
    font-weight: 600;
  }

  .error-message a:hover {
    opacity: 0.9;
  }
</style>
